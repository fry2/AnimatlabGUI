classdef Neuron_NS < matlab.mixin.SetGet
    %NEURON_NS Summary of this class goes here
    %   Detailed explanation goes here
    
    properties
        ID
        location = [233.25 61];
%         size = [44 43.5];
        size = [46.75 40];
        name
        outlinks
        inlinks
        enabled = 'True';
        restingpotential = -0.1;
        timeconstant = 0.005;
        initialthreshold = 0.05;
        relativeaccomodation = 0.3;
        accomodationtimeconstant = 0.01;
        AHPconductance = 1e-006;
        AHPtimeconstant = 0.003;
        ca_act_ID
        ca_act_midpoint = -0.03;
        ca_act_slope = 0.1;
        ca_act_timeconstant = 0.02;
        ca_deact_ID
        ca_deact_midpoint = -0.09;
        ca_deact_slope = -0.1;
        ca_deact_timeconstant = 7.5;
        tonicstimulus = 0;
        tonicnoise = 0;
        type = 'neuron';
    end
    
    methods
        function obj = Neuron_NS(id,location)
            obj.ID = id;
            obj.location = round(location);
            obj.ca_act_ID = strcat(id,'-1');
            obj.ca_deact_ID = strcat(id,'-2');
            obj.name = id(1:end-3);
            %obj.name = id;
        end
        
        function out_text = build_subsystem_text(obj)
            if ~ischar(obj.inlinks)
                inlinks_snippet = '<InLinks/>';
            else
                inlinks_snippet = {'<InLinks>';...
                    ['<ID>',obj.inlinks,'</ID>'];...
                    '</InLinks>'};
            end
            if ~ischar(obj.outlinks)
                outlinks_snippet = '<OutLinks/>';
            else
                outlinks_snippet = {'<OutLinks>';...
                    ['<ID>',obj.outlinks,'</ID>'];...
                    '</OutLinks>'};
            end
            out_text = [{'<Node>';...
                '<AssemblyFile>IntegrateFireGUI.dll</AssemblyFile>';...
                '<ClassName>IntegrateFireGUI.DataObjects.Behavior.Neurons.NonSpiking</ClassName>';...
                ['<ID>',obj.ID,'</ID>'];...
                '<Alignment>CenterMiddle</Alignment>';...
                '<AutoSize>None</AutoSize>';...
                '<BackMode>Transparent</BackMode>';...
                '<DashStyle>Solid</DashStyle>';...
                '<DrawColor>-16777216</DrawColor>';...
                '<DrawWidth>1</DrawWidth>';...
                '<FillColor>-7876870</FillColor>';...
                '<Font Family="Arial" Size="8" Bold="True" Underline="False" Strikeout="False" Italic="False"/>';...
                '<Gradient>False</Gradient>';...
                '<GradientColor>0</GradientColor>';...
                '<GradientMode>BackwardDiagonal</GradientMode>';...
                '<DiagramImageName/>';...
                '<ImageName/>';...
                '<ImageLocation x="0" y="0"/>';...
                '<ImagePosition>RelativeToText</ImagePosition>';...
                '<InLinkable>True</InLinkable>';...
                '<LabelEdit>True</LabelEdit>';...
                ['<Location x="',num2str(obj.location(1)),'" y="',num2str(obj.location(2)),'"/>'];...
                '<OutLinkable>True</OutLinkable>';...
                '<ShadowStyle>None</ShadowStyle>';...
                '<ShadowColor>-16777216</ShadowColor>';...
                '<ShadowSize Width="0" Height="0"/>';...
                '<Shape>Termination</Shape>';...
                '<ShapeOrientation>Angle0</ShapeOrientation>';...
                ['<Size Width="',num2str(obj.size(1)),'" Height="',num2str(obj.size(1)),'"/>'];...
                ['<Text>',obj.name,'</Text>'];...
                '<TextColor>-16777216</TextColor>';...
                '<TextMargin Width="0" Height="0"/>';...
                '<ToolTip/>';...
                '<Transparent>False</Transparent>';...
                '<Url/>';...
                '<XMoveable>True</XMoveable>';...
                '<XSizeable>True</XSizeable>';...
                '<YMoveable>True</YMoveable>';...
                '<YSizeable>True</YSizeable>';...
                '<ZOrder>0</ZOrder>';...
                '<ZOrder>0</ZOrder>';...
                '<TemplateNode>False</TemplateNode>';...
                '<TemplateNodeCount>1</TemplateNodeCount>';...
                '<TemplateChangeScript/>'};...
                inlinks_snippet;...
                outlinks_snippet;...
                {['<Enabled>',obj.enabled,'</Enabled>'];...
                ['<RestingPotential Value="',num2str(obj.restingpotential*1000),'" Scale="milli" Actual="',num2str(obj.restingpotential),'"/>'];...
                '<RelativeSize Value="1" Scale="None" Actual="1"/>';...
                ['<TimeConstant Value="',num2str(obj.timeconstant*1000),'" Scale="milli" Actual="',num2str(obj.timeconstant),'"/>'];...
                ['<InitialThreshold Value="',num2str(obj.initialthreshold*1000),'" Scale="milli" Actual="',num2str(obj.initialthreshold),'"/>'];...
                ['<RelativeAccomodation Value="0.3" Scale="None" Actual="',num2str(obj.relativeaccomodation),'"/>'];...
                ['<AccomodationTimeConstant Value="',num2str(obj.accomodationtimeconstant*1000),'" Scale="milli" Actual="',num2str(obj.accomodationtimeconstant),'"/>'];...
                ['<AHP_Conductance Value="',num2str(obj.AHPconductance*1000000),'" Scale="micro" Actual="',num2str(obj.AHPconductance),'"/>'];...
                ['<AHP_TimeConstant Value="',num2str(obj.AHPtimeconstant*1000),'" Scale="milli" Actual="',num2str(obj.AHPtimeconstant),'"/>'];...
                '<MaxCaConductance Value="0" Scale="micro" Actual="0"/>';...
                '<CaActivation>';...
                ['<ID>',obj.ca_act_ID,'</ID>'];...
                ['<MidPoint Value="',num2str(obj.ca_act_midpoint*1000),'" Scale="milli" Actual="',num2str(obj.ca_act_midpoint),'"/>'];...
                ['<Slope Value="',num2str(obj.ca_act_slope),'" Scale="None" Actual="',num2str(obj.ca_act_slope),'"/>'];...
                ['<TimeConstant Value="',num2str(obj.ca_act_timeconstant*1000),'" Scale="milli" Actual="',num2str(obj.ca_act_timeconstant),'"/>'];...
                '<ActivationType>True</ActivationType>';...
                '</CaActivation>';...
                '<CaDeactivation>';...
                ['<ID>',obj.ca_deact_ID,'</ID>'];...
                ['<MidPoint Value="',num2str(obj.ca_deact_midpoint*1000),'" Scale="milli" Actual="',num2str(obj.ca_deact_midpoint),'"/>'];...
                ['<Slope Value="',num2str(obj.ca_deact_slope),'" Scale="None" Actual="',num2str(obj.ca_deact_slope),'"/>'];...
                ['<TimeConstant Value="',num2str(obj.ca_deact_timeconstant*1000),'" Scale="milli" Actual="',num2str(obj.ca_deact_timeconstant),'"/>'];...
                '<ActivationType>False</ActivationType>';...
                '</CaDeactivation>';...
                '<InitAtBottom>True</InitAtBottom>';...
                ['<TonicStimulus Value="',num2str(obj.tonicstimulus*1000000000),'" Scale="nano" Actual="',num2str(obj.tonicstimulus),'"/>'];...
                ['<TonicNoise Value="',num2str(obj.tonicnoise*1000),'" Scale="milli" Actual="',num2str(obj.tonicnoise),'"/>'];...
                '</Node>'}];
        end
        
        function out_text = build_cdata_text(obj)
            out_text = 	{['  <Node Left="',num2str(obj.location(1)),'" Top="',num2str(obj.location(2)),'" Width="',num2str(obj.size(1)),'" Height="',num2str(obj.size(2)),'">'];...
                '    <Shadow Style="None" Color="-16777216" Width="0" Height="0" />';...
                '    <Shape Style="Termination" Orientation="so_0" />';...
                '    <FillColor>-7876870</FillColor>';...
                '    <DrawColor>-16777216</DrawColor>';...
                '    <TextColor>-16777216</TextColor>';...
                '    <GradientColor>0</GradientColor>';...
                ['    <Text>',obj.name,'</Text>'];...
                '    <Font Name="Arial" Size="8" Bold="True" Italic="False" Strikeout="False" Underline="False" />';...
                ['    <Tag>',obj.ID,'</Tag>'];...
                '  </Node>'};
        end
    end
end

